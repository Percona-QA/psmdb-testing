- name: Install pip (AL2023)
  become: true
  package:
    name: python3-pip
    state: present
  when: ansible_facts.distribution | lower == 'amazon'

- name: Create venv (AL2023)
  become: true
  command: /usr/bin/python3 -m venv /opt/ansible-venv
  args:
    creates: /opt/ansible-venv/bin/python
  when: ansible_facts.distribution | lower == 'amazon'

- name: Upgrade pip in venv (AL2023)
  become: true
  command: /opt/ansible-venv/bin/python -m pip install --upgrade pip
  when: ansible_facts.distribution | lower == 'amazon'

- name: Install deps in venv (AL2023)
  become: true
  command: /opt/ansible-venv/bin/python -m pip install --upgrade --ignore-installed docker requests
  when: ansible_facts.distribution | lower == 'amazon'

- name: Use venv interpreter (AL2023)
  set_fact:
    ansible_python_interpreter: /opt/ansible-venv/bin/python
  when: ansible_facts.distribution | lower == 'amazon'